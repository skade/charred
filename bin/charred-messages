require 'tinder'
require 'term/ansicolor'
require 'shellwords'

include Term::ANSIColor

campfire = Tinder::Campfire.new ARGV[0], :token => ARGV[1]

room = campfire.rooms.first

room.listen do |m|
  if m.type == "TextMessage"
    print green { bold { m.user.name } }
    print blue { bold { ": " } }
    print white { m.body }, "\n"
    message = Shellwords.escape(m.user.name + ": " + m.body)
    system("tmux display-message #{message}")
  else
    print red { "unhandled message #{m.inspect} \n" }
  end
end
